<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latihan Soal Bilangan Berpangkat (HOTS)</title>
    <!-- Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax untuk menampilkan rumus matematika -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* Style tambahan untuk tampilan yang lebih baik */
        body {
            font-family: 'Inter', sans-serif;
        }
        .question-card {
            transition: all 0.3s ease;
        }
        .disabled-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <header class="text-center mb-8 bg-white p-6 rounded-xl shadow-md">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-700">Latihan Soal HOTS</h1>
            <p class="text-xl text-slate-500 mt-2">Materi: Bilangan Berpangkat</p>
        </header>

        <!-- Form Data Siswa -->
        <div id="student-data-form" class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Isi Data Diri</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="student-name" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                    <input type="text" id="student-name" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Masukkan nama lengkap">
                </div>
                <div>
                    <label for="student-class" class="block text-sm font-medium text-gray-700 mb-1">Kelas</label>
                    <input type="text" id="student-class" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Contoh: IX A">
                </div>
            </div>
            <button id="start-quiz-btn" class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition duration-300">
                Mulai Kerjakan
            </button>
        </div>
        
        <!-- Peringatan Anti-Cheat -->
        <div id="cheat-warning" class="hidden fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl text-center max-w-sm">
                <h3 class="text-2xl font-bold text-red-600">PERINGATAN!</h3>
                <p class="mt-4 text-gray-700">Tes berakhir karena Anda mencoba keluar dari halaman atau membuka tab baru. Semua jawaban telah diblokir.</p>
            </div>
        </div>

        <!-- Kontainer Soal -->
        <main id="quiz-container" class="hidden">
            <!-- Soal akan dimuat di sini oleh JavaScript -->
        </main>

        <!-- Tombol Selesai -->
        <div id="finish-button-container" class="text-center mt-8 hidden">
             <button id="finish-btn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-md hover:bg-green-700 transition duration-300 text-lg">
                Selesai & Lihat Skor
            </button>
        </div>

        <!-- Hasil & Form Kirim Jawaban -->
        <div id="result-container" class="hidden bg-white p-8 rounded-xl shadow-md mt-8 text-center">
            <h2 class="text-2xl font-bold mb-4">Hasil Pengerjaan</h2>
            <p id="score-text" class="text-4xl font-bold text-indigo-600 mb-6">Skor Anda: 0</p>
            <p class="mb-2 text-gray-600">Terima kasih telah mengerjakan. Silakan kirim jawaban Anda untuk direkap.</p>
            
            <!-- Form ini akan mengirim data ke Google Sheets melalui Apps Script -->
            <form id="submit-form">
                <!-- Data siswa & skor akan diisi secara otomatis oleh JS -->
                <input type="hidden" name="Nama" id="form-student-name">
                <input type="hidden" name="Kelas" id="form-student-class">
                <input type="hidden" name="Skor" id="form-score">
                <input type="hidden" name="Timestamp" id="form-timestamp">
                 <!-- Jawaban Detail -->
                <input type="hidden" name="Jawaban" id="form-answers">
                
                <button type="submit" id="submit-btn" class="w-full md:w-auto mt-4 bg-blue-600 text-white font-bold py-3 px-6 rounded-md hover:bg-blue-700 transition duration-300">
                    Kirim Jawaban ke Guru
                </button>
                <p id="submit-status" class="mt-4 text-sm text-green-600"></p>
            </form>
        </div>
    </div>

<script>
    // URL Google Apps Script Web App Anda
    // GANTI URL INI dengan URL yang Anda dapatkan setelah mendeploy Google Apps Script.
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwkXmaJHycizs9MmBbs_K3JTONfY4YoiCNtRCYp_1f6ERdNqPwQplXD-1T-R_u1V0b-sA/exec";

    // --- DATA SOAL ---
    const quizData = [
        {
            question: "Sebuah sel amoeba membelah diri menjadi dua setiap 20 menit. Jika pada pukul 07.00 terdapat $2^{3}$ sel amoeba, berapa banyak sel amoeba pada pukul 09.00?",
            options: ["$2^{9}$", "$2^{10}$", "$2^{8}$", "$2^{11}$"],
            answer: "$2^{9}$"
        },
        {
            question: "Pak Eko menyimpan uang di bank sebesar Rp 10.000.000 dengan sistem bunga majemuk sebesar 10% per tahun. Berapakah total uang Pak Eko setelah 2 tahun? Rumus: $M_n = M_0(1+b)^n$.",
            options: ["Rp 11.200.000", "Rp 12.000.000", "Rp 12.100.000", "Rp 13.000.000"],
            answer: "Rp 12.100.000"
        },
        {
            question: "Sebuah virus komputer dapat menyalin dirinya menjadi 3 virus baru setiap 1 detik di sebuah jaringan. Jika pada detik pertama ada 1 virus, berapa total virus yang ada pada detik ke-5?",
            options: ["$3^4$", "$3^5$", "15", "$5^3$"],
            answer: "$3^4$"
        },
        {
            question: "Sebuah kertas berbentuk persegi memiliki panjang sisi $2^{5}$ cm. Kertas tersebut dilipat menjadi dua bagian sama besar secara berulang sebanyak 3 kali. Berapakah luas kertas setelah lipatan terakhir?",
            options: ["$2^{4} \\, \\text{cm}^2$", "$2^{7} \\, \\text{cm}^2$", "$2^{8} \\, \\text{cm}^2$", "$2^{10} \\, \\text{cm}^2$"],
            answer: "$2^{7} \\, \\text{cm}^2$"
        },
        {
            question: "Volume sebuah kubus raksasa adalah $27^{4} \\, \\text{m}^3$. Kubus tersebut akan dicat ulang. Jika 1 liter cat dapat menutupi permukaan seluas $3^2 \\, \\text{m}^2$, berapa liter cat yang dibutuhkan untuk menutupi seluruh permukaannya?",
            options: ["$2 \\cdot 3^{5}$ liter", "$2 \\cdot 3^{6}$ liter", "$6 \\cdot 3^{6}$ liter", "$6 \\cdot 3^{7}$ liter"],
            answer: "$2 \\cdot 3^{6}$ liter"
        }
    ];

    // --- VARIABEL GLOBAL ---
    let currentAnswers = {};
    let quizStarted = false;
    let cheatingDetected = false;

    // --- ELEMEN DOM ---
    const studentForm = document.getElementById('student-data-form');
    const startBtn = document.getElementById('start-quiz-btn');
    const quizContainer = document.getElementById('quiz-container');
    const finishBtnContainer = document.getElementById('finish-button-container');
    const finishBtn = document.getElementById('finish-btn');
    const resultContainer = document.getElementById('result-container');
    const scoreText = document.getElementById('score-text');
    const cheatWarning = document.getElementById('cheat-warning');
    const submitForm = document.getElementById('submit-form');
    const submitBtn = document.getElementById('submit-btn');
    const submitStatus = document.getElementById('submit-status');

    // --- FUNGSI-FUNGSI ---

    // Fungsi untuk memulai kuis
    function startQuiz() {
        const studentName = document.getElementById('student-name').value.trim();
        const studentClass = document.getElementById('student-class').value.trim();

        if (studentName === '' || studentClass === '') {
            alert('Harap isi nama dan kelas terlebih dahulu!');
            return;
        }

        quizStarted = true;
        studentForm.classList.add('hidden');
        quizContainer.classList.remove('hidden');
        finishBtnContainer.classList.remove('hidden');
        loadQuestions();

        // Aktifkan deteksi kecurangan HANYA setelah kuis dimulai
        window.addEventListener('blur', handleCheating);
    }
    
    // Fungsi untuk memuat soal
    function loadQuestions() {
        let questionHTML = '';
        quizData.forEach((item, index) => {
            questionHTML += `
                <div class="bg-white p-6 rounded-xl shadow-md mb-6 question-card">
                    <p class="font-semibold text-lg mb-4">Soal ${index + 1}:</p>
                    <div class="text-gray-800 mb-6 text-base md:text-lg">${item.question}</div>
                    <div class="space-y-3">
            `;
            item.options.forEach(option => {
                const optionId = `q${index}_${option}`;
                questionHTML += `
                    <div class="flex items-center">
                        <input type="radio" id="${optionId}" name="question${index}" value="${option}" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                        <label for="${optionId}" class="ml-3 block text-md text-gray-700">${option}</label>
                    </div>
                `;
            });
            questionHTML += `</div></div>`;
        });
        quizContainer.innerHTML = questionHTML;
        MathJax.typeset(); // Panggil MathJax untuk merender rumus

        // Tambahkan event listener untuk setiap pilihan jawaban
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const questionIndex = e.target.name.replace('question', '');
                currentAnswers[questionIndex] = e.target.value;
            });
        });
    }

    // Fungsi untuk menangani kecurangan
    function handleCheating() {
        if (cheatingDetected || !quizStarted) return; // Jangan jalankan jika sudah terdeteksi atau kuis belum mulai

        cheatingDetected = true;
        cheatWarning.classList.remove('hidden');

        // Nonaktifkan semua pilihan
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.disabled = true;
        });
        
        // Sembunyikan tombol selesai dan hasil
        finishBtn.disabled = true;
        finishBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
        finishBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
        resultContainer.classList.add('hidden');
    }
    
    // Fungsi untuk menghitung skor
    function calculateScore() {
        if (cheatingDetected) {
            scoreText.textContent = "Skor tidak valid karena terdeteksi keluar halaman.";
            scoreText.classList.remove('text-indigo-600');
            scoreText.classList.add('text-red-600', 'text-2xl');
            submitBtn.disabled = true;
            submitBtn.textContent = "Pengiriman Diblokir";
            submitBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
            return 0;
        };

        let score = 0;
        quizData.forEach((item, index) => {
            if (currentAnswers[index] && currentAnswers[index] === item.answer) {
                score += 1;
            }
        });
        
        const finalScore = (score / quizData.length) * 100;
        scoreText.textContent = `Skor Anda: ${finalScore.toFixed(0)}`;
        return finalScore.toFixed(0);
    }

    // Fungsi untuk menampilkan hasil
    function showResults() {
        quizStarted = false; // Kuis selesai
        window.removeEventListener('blur', handleCheating); // Nonaktifkan pendeteksi setelah selesai

        const finalScore = calculateScore();
        
        quizContainer.classList.add('hidden');
        finishBtnContainer.classList.add('hidden');
        resultContainer.classList.remove('hidden');

        // Isi form untuk pengiriman
        document.getElementById('form-student-name').value = document.getElementById('student-name').value;
        document.getElementById('form-student-class').value = document.getElementById('student-class').value;
        document.getElementById('form-score').value = finalScore;
        document.getElementById('form-timestamp').value = new Date().toLocaleString('id-ID');

        // Siapkan detail jawaban
        let answerSummary = "";
        quizData.forEach((q, i) => {
           answerSummary += `Soal ${i+1}: ${currentAnswers[i] || 'Tidak Dijawab'} (Kunci: ${q.answer})\n`;
        });
        document.getElementById('form-answers').value = answerSummary;
    }
    
    // Fungsi untuk mengirim data ke Google Sheet
    function submitResults(e) {
        e.preventDefault();
        submitBtn.disabled = true;
        submitBtn.textContent = 'Mengirim...';

        const formData = new FormData(submitForm);
        
        fetch(SCRIPT_URL, { 
            method: 'POST', 
            body: formData
        })
        .then(response => {
            if (response.ok) {
                submitStatus.textContent = 'Jawaban Anda berhasil dikirim! Terima kasih.';
                submitBtn.classList.add('bg-green-500');
                submitBtn.textContent = 'Terkirim!';
            } else {
                 throw new Error('Gagal mengirim. Coba lagi nanti.');
            }
        })
        .catch(error => {
            submitStatus.textContent = 'Terjadi kesalahan saat mengirim jawaban. Periksa koneksi atau hubungi guru.';
            submitStatus.classList.remove('text-green-600');
            submitStatus.classList.add('text-red-600');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Kirim Ulang Jawaban';
        });
    }

    // --- EVENT LISTENERS ---
    startBtn.addEventListener('click', startQuiz);
    finishBtn.addEventListener('click', showResults);
    submitForm.addEventListener('submit', submitResults);

</script>

</body>
</html>
